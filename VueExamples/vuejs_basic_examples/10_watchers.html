<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>监听器</title>
    <!--导入映射表-->
    <script type="importmap">
      {
        "imports": {
          "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
          "es-toolkit": "https://esm.sh/es-toolkit@%5E1",
          "axios": "https://unpkg.com/axios@1.10.0/dist/esm/axios.min.js"
        }
      }
    </script>
  </head>

  <body>
    <div id="app">
      <h1>监听器</h1>
      <p>当输入包含问号时，自动获取答案。</p>

      <p>
        Ask a yes/no question:
        <input v-model="question" :disabled="loading" />
      </p>
      <p>{{ answer }}</p>
      <img v-if="imgUrl" :src="imgUrl" alt="Answer image" />

      <div>
        <button @click="someobj.count++">count is: {{ someobj.count }}</button>
      </div>
    </div>

    <script type="module">
      import { createApp, ref, watch, reactive } from 'vue'
      import axios from 'axios'

      const app = createApp({
        setup() {
          const question = ref('')
          const answer = ref('Questions usually contain a question mark. ;-)')
          const imgUrl = ref('')
          const loading = ref(false)

          const someobj = reactive({ count: 0 })

          async function getAnswer() {
            loading.value = true
            answer.value = 'Thinking...'
            try {
              const res = await axios.get('https://yesno.wtf/api')
              answer.value = res.data.answer
              imgUrl.value = res.data.image
            } catch (error) {
              answer.value = 'Error, could not load answer. ' + error
            } finally {
              loading.value = false
            }
          }

          watch(question, async (newQuestion, oldQuestion) => {
            if (newQuestion.includes('?') || newQuestion.includes('？')) {
              await getAnswer()
            }
          })

          // watch(
          //   () => someobj.count,
          //   (newQuestion, oldQuestion) => {
          //     console.log(newQuestion, oldQuestion)
          //   }
          // )

          // watch(someobj, (newValue, oldValue) => {
          //   // newValue和oldValue是同一对象
          //   // 在所有嵌套属性变更时，都会触发监听器
          //   console.log(newValue === oldValue)
          // })

          watch(
            () => someobj,
            (newValue, oldValue) => {
              // newValue和oldValue是同一对象
              // 仅当someobj被替换时才会触发监听器
              console.log(newValue === oldValue)
            },
            {
              deep: true,
            }
          )

          return {
            question,
            answer,
            imgUrl,
            loading,
            getAnswer,
            someobj,
          }
        },
      })

      app.mount('#app')
    </script>
  </body>
</html>
