<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>组件基础</title>
    <!--导入映射表-->
    <script type="importmap">
      {
        "imports": {
          "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
          "es-toolkit": "https://esm.sh/es-toolkit@%5E1",
          "axios": "https://unpkg.com/axios@1.10.0/dist/esm/axios.min.js"
        }
      }
    </script>
  </head>

  <body>
    <!--父组件监听子组件事件-->
    <!--子组件通过事件向父组件传递值，父组件在监听事件时通过$event取得值-->
    <!--在Vue 3中，当你使用组合式API时，根元素不能直接使用Vue指令（如:style），
	因为根元素是Vue应用挂载的目标容器。-->
    <div id="blog-posts-enents-1">
      <div :style="{ fontSize: postFontSize + 'em' }">
        <blog-post v-for="post in posts" :key="post.id" :post="post" @enlarge-text="postFontSize += $event">
        </blog-post>
      </div>
    </div>

    <hr color="green" size="2px" />

    <!--监听事件的处理函数为方法-->
    <div id="blog-posts-enents-2">
      <div :style="{ fontSize: postFontSize2 + 'em' }">
        <blog-post v-for="post in posts2" :key="post.id" :post="post" @enlarge-text="onEnlargeText"> </blog-post>
      </div>
    </div>

    <hr color="green" size="2px" />

    <!-- 自定义事件用于创建支持 v-model 的自定义输入组件 -->
    <div id="blog-posts-enents-3">
      <br />
      <custom-input v-model="text"></custom-input>
      <p>{{text}}</p>
    </div>

    <hr color="green" size="2px" />

    <!--通过插槽分发内容-->
    <div id="component-demo4">
      <alert-box>Something bad happened.</alert-box>
    </div>

    <script type="module">
      import { createApp, ref } from 'vue'
      // 第一个应用 - 使用组合式API
      const vm = createApp({
        setup() {
          const posts = ref([
            {
              title: 'hello vue.js',
              author: 'anyu',
            },
            {
              title: 'hello vue.js',
              author: 'anyu',
            },
          ])

          const postFontSize = ref(1)

          return {
            posts,
            postFontSize,
          }
        },
      })

      vm.component('blog-post', {
        props: ['post'],
        template: `
          <div>
            <h3>{{post.title}}</h3>
            <button @click="$emit('enlarge-text', 0.2)">
              Enlarge text
            </button>
          </div>
        `,
      })

      vm.mount('#blog-posts-enents-1')

      // 第二个应用 - 使用组合式API
      const vm2 = createApp({
        setup() {
          const posts2 = ref([
            {
              title: 'hello vue.js',
              author: 'anyu',
            },
            {
              title: 'hello vue.js',
              author: 'anyu',
            },
          ])

          const postFontSize2 = ref(1)

          const onEnlargeText = changeValue => {
            postFontSize2.value += changeValue
          }

          return {
            posts2,
            postFontSize2,
            onEnlargeText,
          }
        },
      })

      vm2.component('blog-post', {
        props: ['post'],
        template: `
          <div>
            <h3>{{post.title}}</h3>
            <button @click="$emit('enlarge-text', 0.1)">
              Enlarge text
            </button>
          </div>
        `,
      })
      vm2.mount('#blog-posts-enents-2')

      // 第三个应用 - 使用组合式API
      const vm3 = createApp({
        setup() {
          const text = ref('')

          return {
            text,
          }
        },
      })

      vm3.component('custom-input', {
        props: ['modelValue'],
        emits: ['update:modelValue'],
        template: `
          <input
            :value="modelValue"
            @input="$emit('update:modelValue', $event.target.value)" >
        `,
      })
      vm3.mount('#blog-posts-enents-3')

      // 第四个应用 - 使用组合式API
      const vm4 = createApp({})
      vm4.component('alert-box', {
        template: `
          <div class="demo-alert-box">
            <strong>Error</strong>
			      <br />
            <slot></slot>
          </div>
        `,
      })
      vm4.mount('#component-demo4')
    </script>
  </body>
</html>
