<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript 变量作用域示例</title>
    <script>
      // 启用严格模式，变量必须先定义再使用，避免出错
      'use strict'

      // 演示 var 和 let 的作用域差异
      {
        // 注意：这里使用 var 是为了演示其函数作用域特性（教学目的）
        var carName = 'Volvo' // var 是函数作用域，会提升到函数顶部
        let carName2 = 'Volvo' // let 是块级作用域
      }

      console.log(carName) // 可以访问，因为 var 不受块级作用域限制
      // console.log(carName2); // 会报错：ReferenceError，let 是块级作用域

      // 演示 const 对象的属性可以修改
      const car = {
        name: 'Volvo new',
        color: 'red',
      }

      // const 声明的对象，其属性可以修改
      // 如果使用 Object.freeze(car)，则属性不可修改
      // Object.freeze(car);
      car.name = 'BMW'
      console.log(car.name)

      // 演示 strict mode 下的 this
      function getWindow() {
        return this
      }

      console.log(getWindow()) // strict mode 下为 undefined（非严格模式下为 window）

      // 演示 call 和 apply 方法
      const person1 = {
        fullName() {
          return `${this.firstName} ${this.lastName}`
        },
      }

      const person2 = {
        firstName: 'John',
        lastName: 'Doe',
      }

      console.log(person1.fullName.call(person2)) // 返回 "John Doe"
      console.log(person1.fullName.apply(person2)) // 返回 "John Doe"

      // 演示 for...in 循环中使用 const
      // 理解每次循环迭代都会创建一个新的块级作用域的变量
      for (const key in { a: 1, b: 'hi' }) {
        console.log(key)
      }

      // 移除内联事件处理器，使用 addEventListener
      document.addEventListener('DOMContentLoaded', () => {
        const hideButton = document.getElementById('hideButton')
        if (hideButton) {
          hideButton.addEventListener('click', function () {
            this.style.display = 'none'
          })
        }
      })
    </script>
  </head>

  <body>
    <main>
      <h1>JavaScript 变量学习示例</h1>

      <section>
        <h2>演示内容</h2>
        <ul>
          <li>var vs let - 作用域差异</li>
          <li>const 对象的属性修改</li>
          <li>严格模式下的 this 行为</li>
          <li>call 和 apply 方法</li>
          <li>for...in 循环中的 const</li>
        </ul>
      </section>

      <section>
        <h2>交互演示</h2>
        <button type="button" id="hideButton">点我后我就消失了</button>
      </section>

      <section>
        <h2>查看控制台</h2>
        <p>打开浏览器控制台（F12）查看变量作用域和方法调用的输出结果。</p>
      </section>
    </main>
  </body>
</html>
